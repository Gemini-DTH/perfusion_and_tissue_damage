Bootstrap: docker
From: continuumio/miniconda3

%files
    . /app

%post
    apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
    libgl1-mesa-glx

    . /opt/conda/etc/profile.d/conda.sh
    cd /app/ && conda env create -f environment.yml
    conda activate perfusion
    cd /app/ && pip install --no-cache-dir ./in-silico-trial
    cd /app/ && pip install --no-cache-dir -r requirements.txt

%runscript
    export DIJITSO_CACHE_DIR=/patient/.cache
    . /opt/conda/etc/profile.d/conda.sh
    conda activate perfusion
    cd /app/ && exec python3 API.py "$@"